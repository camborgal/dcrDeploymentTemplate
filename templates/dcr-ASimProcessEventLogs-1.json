{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"dataCollectionRuleName": {"type": "string", "metadata": {"description": "Specifies the name of the Data Collection Rule to create."}}, "location": {"defaultValue": "[resourceGroup().location]", "type": "string", "metadata": {"description": "Specifies the location in which to create the Data Collection Rule."}}, "workspaceResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Log Analytics workspace to use."}}, "endpointResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Data Collection Endpoint to use."}}}, "resources": [{"type": "Microsoft.Insights/dataCollectionRules", "apiVersion": "2021-09-01-preview", "name": "[parameters('dataCollectionRuleName')]", "location": "[parameters('location')]", "properties": {"dataCollectionEndpointId": "[parameters('endpointResourceId')]", "streamDeclarations": {"Custom-ASimProcessEventLogs": {"columns": [{"name": "ActingProcessCommandLine", "type": "string"}, {"name": "ActingProcessCreationTime", "type": "datetime"}, {"name": "ActingProcessFileCompany", "type": "string"}, {"name": "ActingProcessFileDescription", "type": "string"}, {"name": "ActingProcessFileInternalName", "type": "string"}, {"name": "ActingProcessFilename", "type": "string"}, {"name": "ActingProcessFileOriginalName", "type": "string"}, {"name": "ActingProcessFileProduct", "type": "string"}, {"name": "ActingProcessFileSize", "type": "long"}, {"name": "ActingProcessFileVersion", "type": "string"}, {"name": "ActingProcessGuid", "type": "string"}, {"name": "ActingProcessId", "type": "string"}, {"name": "ActingProcessIMPHASH", "type": "string"}, {"name": "ActingProcessInjectedAddress", "type": "string"}, {"name": "ActingProcessIntegrityLevel", "type": "string"}, {"name": "ActingProcessIsHidden", "type": "boolean"}, {"name": "ActingProcessMD5", "type": "string"}, {"name": "ActingProcessName", "type": "string"}, {"name": "ActingProcessSHA1", "type": "string"}, {"name": "ActingProcessSHA256", "type": "string"}, {"name": "ActingProcessSHA512", "type": "string"}, {"name": "ActingProcessTokenElevation", "type": "string"}, {"name": "ActorOriginalUserType", "type": "string"}, {"name": "ActorScope", "type": "string"}, {"name": "ActorScopeId", "type": "string"}, {"name": "ActorSessionId", "type": "string"}, {"name": "ActorUserId", "type": "string"}, {"name": "ActorUserIdType", "type": "string"}, {"name": "ActorUsername", "type": "string"}, {"name": "ActorUsernameType", "type": "string"}, {"name": "ActorUserType", "type": "string"}, {"name": "AdditionalFields", "type": "dynamic"}, {"name": "DvcAction", "type": "string"}, {"name": "DvcDescription", "type": "string"}, {"name": "DvcDomain", "type": "string"}, {"name": "DvcDomainType", "type": "string"}, {"name": "DvcFQDN", "type": "string"}, {"name": "DvcHostname", "type": "string"}, {"name": "DvcId", "type": "string"}, {"name": "DvcIdType", "type": "string"}, {"name": "DvcInterface", "type": "string"}, {"name": "DvcIpAddr", "type": "string"}, {"name": "DvcMacAddr", "type": "string"}, {"name": "DvcOriginalAction", "type": "string"}, {"name": "DvcOs", "type": "string"}, {"name": "DvcOsVersion", "type": "string"}, {"name": "DvcScope", "type": "string"}, {"name": "DvcScopeId", "type": "string"}, {"name": "DvcZone", "type": "string"}, {"name": "EventCount", "type": "int"}, {"name": "EventEndTime", "type": "datetime"}, {"name": "EventMessage", "type": "string"}, {"name": "EventOriginalResultDetails", "type": "string"}, {"name": "EventOriginalSeverity", "type": "string"}, {"name": "EventOriginalSubType", "type": "string"}, {"name": "EventOriginalType", "type": "string"}, {"name": "EventOriginalUid", "type": "string"}, {"name": "EventOwner", "type": "string"}, {"name": "EventProduct", "type": "string"}, {"name": "EventProductVersion", "type": "string"}, {"name": "EventReportUrl", "type": "string"}, {"name": "EventResult", "type": "string"}, {"name": "EventResultDetails", "type": "string"}, {"name": "EventSchemaVersion", "type": "string"}, {"name": "EventSeverity", "type": "string"}, {"name": "EventStartTime", "type": "datetime"}, {"name": "EventSubType", "type": "string"}, {"name": "EventType", "type": "string"}, {"name": "EventVendor", "type": "string"}, {"name": "ParentProcessCreationTime", "type": "datetime"}, {"name": "ParentProcessFileCompany", "type": "string"}, {"name": "ParentProcessFileDescription", "type": "string"}, {"name": "ParentProcessFileProduct", "type": "string"}, {"name": "ParentProcessFileVersion", "type": "string"}, {"name": "ParentProcessGuid", "type": "string"}, {"name": "ParentProcessId", "type": "string"}, {"name": "ParentProcessIMPHASH", "type": "string"}, {"name": "ParentProcessInjectedAddress", "type": "string"}, {"name": "ParentProcessIntegrityLevel", "type": "string"}, {"name": "ParentProcessIsHidden", "type": "boolean"}, {"name": "ParentProcessMD5", "type": "string"}, {"name": "ParentProcessName", "type": "string"}, {"name": "ParentProcessSHA1", "type": "string"}, {"name": "ParentProcessSHA256", "type": "string"}, {"name": "ParentProcessSHA512", "type": "string"}, {"name": "ParentProcessTokenElevation", "type": "string"}, {"name": "RuleName", "type": "string"}, {"name": "RuleNumber", "type": "int"}, {"name": "SourceSystem", "type": "string"}, {"name": "TargetOriginalUserType", "type": "string"}, {"name": "TargetProcessCommandLine", "type": "string"}, {"name": "TargetProcessCreationTime", "type": "datetime"}, {"name": "TargetProcessCurrentDirectory", "type": "string"}, {"name": "TargetProcessFileCompany", "type": "string"}, {"name": "TargetProcessFileDescription", "type": "string"}, {"name": "TargetProcessFileInternalName", "type": "string"}, {"name": "TargetProcessFilename", "type": "string"}, {"name": "TargetProcessFileOriginalName", "type": "string"}, {"name": "TargetProcessFileProduct", "type": "string"}, {"name": "TargetProcessFileSize", "type": "long"}, {"name": "TargetProcessFileVersion", "type": "string"}, {"name": "TargetProcessGuid", "type": "string"}, {"name": "TargetProcessId", "type": "string"}, {"name": "TargetProcessIMPHASH", "type": "string"}, {"name": "TargetProcessInjectedAddress", "type": "string"}, {"name": "TargetProcessIntegrityLevel", "type": "string"}, {"name": "TargetProcessIsHidden", "type": "boolean"}, {"name": "TargetProcessMD5", "type": "string"}, {"name": "TargetProcessName", "type": "string"}, {"name": "TargetProcessSHA1", "type": "string"}, {"name": "TargetProcessSHA256", "type": "string"}, {"name": "TargetProcessSHA512", "type": "string"}, {"name": "TargetProcessStatusCode", "type": "string"}, {"name": "TargetProcessTokenElevation", "type": "string"}, {"name": "TargetScope", "type": "string"}, {"name": "TargetScopeId", "type": "string"}, {"name": "TargetUserId", "type": "string"}, {"name": "TargetUserIdType", "type": "string"}, {"name": "TargetUsername", "type": "string"}, {"name": "TargetUsernameType", "type": "string"}, {"name": "TargetUserSessionGuid", "type": "string"}, {"name": "TargetUserSessionId", "type": "string"}, {"name": "TargetUserType", "type": "string"}, {"name": "ThreatCategory", "type": "string"}, {"name": "ThreatConfidence", "type": "int"}, {"name": "ThreatField", "type": "string"}, {"name": "ThreatFirstReportedTime", "type": "datetime"}, {"name": "ThreatId", "type": "string"}, {"name": "ThreatIsActive", "type": "boolean"}, {"name": "ThreatLastReportedTime", "type": "datetime"}, {"name": "ThreatName", "type": "string"}, {"name": "ThreatOriginalConfidence", "type": "string"}, {"name": "ThreatOriginalRiskLevel", "type": "string"}, {"name": "ThreatRiskLevel", "type": "int"}, {"name": "TimeGenerated", "type": "datetime"}, {"name": "Type", "type": "string"}]}}, "destinations": {"logAnalytics": [{"workspaceResourceId": "[parameters('workspaceResourceId')]", "name": "logAnalyticsWorkspace"}]}, "dataFlows": [{"streams": ["Custom-ASimProcessEventLogs"], "destinations": ["logAnalyticsWorkspace"], "transformKql": "source", "outputStream": "Microsoft-ASimProcessEventLogs"}]}}], "outputs": {"dataCollectionRuleId": {"type": "string", "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('dataCollectionRuleName'))]"}}}