{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"dataCollectionRuleName": {"type": "string", "metadata": {"description": "Specifies the name of the Data Collection Rule to create."}}, "location": {"defaultValue": "[resourceGroup().location]", "type": "string", "metadata": {"description": "Specifies the location in which to create the Data Collection Rule."}}, "workspaceResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Log Analytics workspace to use."}}, "endpointResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Data Collection Endpoint to use."}}}, "resources": [{"type": "Microsoft.Insights/dataCollectionRules", "apiVersion": "2021-09-01-preview", "name": "[parameters('dataCollectionRuleName')]", "location": "[parameters('location')]", "properties": {"dataCollectionEndpointId": "[parameters('endpointResourceId')]", "streamDeclarations": {"Custom-Syslog": {"columns": [{"name": "CollectorHostName", "type": "string"}, {"name": "Computer", "type": "string"}, {"name": "EventTime", "type": "datetime"}, {"name": "Facility", "type": "string"}, {"name": "HostIP", "type": "string"}, {"name": "HostName", "type": "string"}, {"name": "ProcessID", "type": "int"}, {"name": "ProcessName", "type": "string"}, {"name": "SeverityLevel", "type": "string"}, {"name": "SourceSystem", "type": "string"}, {"name": "SyslogMessage", "type": "string"}, {"name": "TimeGenerated", "type": "datetime"}, {"name": "Type", "type": "string"}]}, "Custom-ADAssessmentRecommendation": {"columns": [{"name": "ActionArea", "type": "string"}, {"name": "ActionAreaId", "type": "string"}, {"name": "AffectedObjectName", "type": "string"}, {"name": "AffectedObjectType", "type": "string"}, {"name": "AssessmentId", "type": "string"}, {"name": "Computer", "type": "string"}, {"name": "CustomData", "type": "string"}, {"name": "Description", "type": "string"}, {"name": "Domain", "type": "string"}, {"name": "DomainController", "type": "string"}, {"name": "FocusArea", "type": "string"}, {"name": "FocusAreaId", "type": "string"}, {"name": "Forest", "type": "string"}, {"name": "Recommendation", "type": "string"}, {"name": "RecommendationId", "type": "string"}, {"name": "RecommendationResult", "type": "string"}, {"name": "RecommendationWeight", "type": "real"}, {"name": "SourceSystem", "type": "string"}, {"name": "Technology", "type": "string"}, {"name": "TimeGenerated", "type": "datetime"}, {"name": "Type", "type": "string"}]}}, "destinations": {"logAnalytics": [{"workspaceResourceId": "[parameters('workspaceResourceId')]", "name": "logAnalyticsWorkspace"}]}, "dataFlows": [{"streams": ["Custom-Syslog"], "destinations": ["logAnalyticsWorkspace"], "transformKql": "source", "outputStream": "Microsoft-Syslog"}, {"streams": ["Custom-ADAssessmentRecommendation"], "destinations": ["logAnalyticsWorkspace"], "transformKql": "source", "outputStream": "Microsoft-ADAssessmentRecommendation"}]}}], "outputs": {"dataCollectionRuleId": {"type": "string", "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('dataCollectionRuleName'))]"}}}