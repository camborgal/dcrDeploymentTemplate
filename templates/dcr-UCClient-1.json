{"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#", "contentVersion": "1.0.0.0", "parameters": {"dataCollectionRuleName": {"type": "string", "metadata": {"description": "Specifies the name of the Data Collection Rule to create."}}, "location": {"defaultValue": "[resourceGroup().location]", "type": "string", "metadata": {"description": "Specifies the location in which to create the Data Collection Rule."}}, "workspaceResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Log Analytics workspace to use."}}, "endpointResourceId": {"type": "string", "metadata": {"description": "Specifies the Azure resource ID of the Data Collection Endpoint to use."}}}, "resources": [{"type": "Microsoft.Insights/dataCollectionRules", "apiVersion": "2021-09-01-preview", "name": "[parameters('dataCollectionRuleName')]", "location": "[parameters('location')]", "properties": {"dataCollectionEndpointId": "[parameters('endpointResourceId')]", "streamDeclarations": {"Custom-UCClient": {"columns": [{"name": "AzureADDeviceId", "type": "string"}, {"name": "AzureADTenantId", "type": "string"}, {"name": "City", "type": "string"}, {"name": "Country", "type": "string"}, {"name": "DeviceFamily", "type": "string"}, {"name": "DeviceFormFactor", "type": "string"}, {"name": "DeviceManufacturer", "type": "string"}, {"name": "DeviceModel", "type": "string"}, {"name": "DeviceName", "type": "string"}, {"name": "GlobalDeviceId", "type": "string"}, {"name": "IsDeviceHotpatchEligible", "type": "bool"}, {"name": "IsDeviceHotpatchEnrolled", "type": "bool"}, {"name": "IsDeviceVBSEnabled", "type": "bool"}, {"name": "IsVirtual", "type": "bool"}, {"name": "LastCensusScanTime", "type": "datetime"}, {"name": "LastHotpatchEnrolledTime", "type": "datetime"}, {"name": "LastWUScanTime", "type": "datetime"}, {"name": "OSArchitecture", "type": "string"}, {"name": "OSBuild", "type": "string"}, {"name": "OSBuildNumber", "type": "int"}, {"name": "OSEdition", "type": "string"}, {"name": "OSFeatureUpdateComplianceStatus", "type": "string"}, {"name": "OSFeatureUpdateEOSTime", "type": "datetime"}, {"name": "OSFeatureUpdateReleaseTime", "type": "datetime"}, {"name": "OSFeatureUpdateStatus", "type": "string"}, {"name": "OSQualityUpdateComplianceStatus", "type": "string"}, {"name": "OSQualityUpdateReleaseTime", "type": "datetime"}, {"name": "OSQualityUpdateStatus", "type": "string"}, {"name": "OSRevisionNumber", "type": "int"}, {"name": "OSSecurityUpdateComplianceStatus", "type": "string"}, {"name": "OSSecurityUpdateStatus", "type": "string"}, {"name": "OSServicingChannel", "type": "string"}, {"name": "OSVersion", "type": "string"}, {"name": "PrimaryDiskFreeCapacityMb", "type": "int"}, {"name": "SCCMClientId", "type": "string"}, {"name": "SourceSystem", "type": "string"}, {"name": "TimeGenerated", "type": "datetime"}, {"name": "Type", "type": "string"}, {"name": "UpdateConnectivityLevel", "type": "string"}, {"name": "WUAutomaticUpdates", "type": "int"}, {"name": "WUDeadlineNoAutoRestart", "type": "int"}, {"name": "WUDODownloadMode", "type": "string"}, {"name": "WUFeatureDeadlineDays", "type": "int"}, {"name": "WUFeatureDeferralDays", "type": "int"}, {"name": "WUFeatureGracePeriodDays", "type": "int"}, {"name": "WUFeaturePauseEndTime", "type": "datetime"}, {"name": "WUFeaturePauseStartTime", "type": "datetime"}, {"name": "WUFeaturePauseState", "type": "string"}, {"name": "WUNotificationLevel", "type": "int"}, {"name": "WUPauseUXDisabled", "type": "int"}, {"name": "WUQualityDeadlineDays", "type": "int"}, {"name": "WUQualityDeferralDays", "type": "int"}, {"name": "WUQualityGracePeriodDays", "type": "int"}, {"name": "WUQualityPauseEndTime", "type": "datetime"}, {"name": "WUQualityPauseStartTime", "type": "datetime"}, {"name": "WUQualityPauseState", "type": "string"}, {"name": "WURestartNotification", "type": "int"}, {"name": "WUServiceURLConfigured", "type": "string"}, {"name": "WUUXDisabled", "type": "int"}]}}, "destinations": {"logAnalytics": [{"workspaceResourceId": "[parameters('workspaceResourceId')]", "name": "logAnalyticsWorkspace"}]}, "dataFlows": [{"streams": ["Custom-UCClient"], "destinations": ["logAnalyticsWorkspace"], "transformKql": "source", "outputStream": "Microsoft-UCClient"}]}}], "outputs": {"dataCollectionRuleId": {"type": "string", "value": "[resourceId('Microsoft.Insights/dataCollectionRules', parameters('dataCollectionRuleName'))]"}}}